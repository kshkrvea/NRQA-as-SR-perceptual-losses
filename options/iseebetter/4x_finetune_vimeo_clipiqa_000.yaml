task: 4x_finetune_iseebetter_vimeo_clipiqa_000
model: iseebetter
gpu_ids: [1]
dist: false
find_unused_parameters: false
use_static_graph: true
weight_scale: 4
scale: 4
n_channels: 3

path: 
    root: ../mnt/calypso/checkpoints
    pretrained_netG: ../mnt/calypso/checkpoints/4x_train_iseebetter_vimeo_000/models/50000_G.pth
    pretrained_netD: ../mnt/calypso/checkpoints/4x_train_iseebetter_vimeo_000/models/50000_D.pth
    pretrained_optimizerG: ../mnt/calypso/checkpoints/4x_train_iseebetter_vimeo_000/models/50000_optimizerG.pth
    pretrained_optimizerD: ../mnt/calypso/checkpoints/4x_train_iseebetter_vimeo_000/models/50000_optimizerD.pth

datasets: 
  train: 
    name: vimeo
    dataroot_gt: ../mnt/calypso/datasets/vimeo90k/vimeo90k_train_GT.lmdb/vimeo90k_train_GT.lmdb
    dataroot_lq: ../mnt/calypso/datasets/vimeo90k/vimeo90k_train_LR7frames_4x.lmdb
    #dataroot_gt: ../datasets/vimeo/vimeo90k_train_GT.lmdb
    #dataroot_lq: ../datasets/vimeo/vimeo90k_train_LR7frames.lmdb
    io_backend:
      type: lmdb
    num_frame: 7
    interval_list: [1]
    random_crop: true
    gt_size: 256
    random_reverse: true
    use_hflip: true
    use_rot: true
    pad_sequence: false
    scale: 4
    dataloader_shuffle: true
    dataloader_num_workers: 12
    dataloader_batch_size: 4

  test: 
    name: vimeo
    dataroot_gt: ../mnt/calypso/datasets/vimeo90k/vimeo90k_test_GT.lmdb
    dataroot_lq: ../mnt/calypso/datasets/vimeo90k/vimeo90k_test_LR7frames_4x.lmdb
    io_backend: 
      type: lmdb
    num_frame: 7
    interval_list: [1]
    random_crop: false
    gt_size: 256
    random_reverse: false
    use_hflip: false
    use_rot: false
    pad_sequence: false
    scale: 4
    dataloader_shuffle: false
    dataloader_num_workers: 12
    dataloader_batch_size: 1
        

netG: 
  net_type: iseebetter
  arguments:
    num_channels: 3
    base_filter: 256
    feat: 64
    num_stages: 3
    n_resblock: 5
    nFrames: 7
    scale_factor: 4
  spynet_path: ../mnt/calypso/checkpoints/spynet_sintel_final-3d2a1287.pth
  init_type: default
  freeze_blocks: 0

netD:
  freeze: false

train: 
  adv_loss_weight: 1
  G_lossfn_types: 
    clipiqa:
      weight: 0.005
      mode: NR
      reverse: true

  E_decay: 0 # Exponential Moving Average for netG: set 0 to disable; default setting 0.999

  G_optimizer_type: adam        # fixed, adam is enough
  G_optimizer_lr: 4e-4            # learning rate
  G_optimizer_betas: [0.9,0.99]
  G_optimizer_wd: 0           # weight decay, default 0
  G_optimizer_reuse: true         

  D_optimizer_lr: 4e-4
  D_optimizer_betas: [0.9,0.99]
  D_optimizer_reuse: true 

  fix_iter: 75000
  total_iter: 75000

  G_scheduler:
    type: CosineCycleAnnealingWarmRestarts
    params:
      start_value: 3e-4
      end_value: 1e-6
      cycle_size: 1000
      start_value_mult: 0.8
      end_value_mult: 1
  
  D_scheduler:
    type: CosineCycleAnnealingWarmRestarts
    params:
      start_value: 4e-4
      end_value: 1e-6
      cycle_size: 500
      start_value_mult: 0.8
      end_value_mult: 1

  G_param_strict: false
  E_param_strict: false

  checkpoint_test: 500       # for testing
  checkpoint_save: 500           # for saving model
  checkpoint_print: 10         # for print
