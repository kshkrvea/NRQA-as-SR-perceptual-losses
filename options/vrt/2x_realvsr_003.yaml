
task: 003_finetune_vrt_realvsr_7frames
model: vrt
gpu_ids: [3]
dist: true
find_unused_parameters: false
use_static_graph: true
weights_scale: 2
scale: 2
n_channels: 3

# finetune on realvsr pretrained 002_finetune_vrt_realvsr_7frames model (all layers)
path: 
    root: experiments
    pretrained_netG: experiments/002_finetune_vrt_realvsr_7frames/models/12000_G.pth
    pretrained_optimizerG: experiments/002_finetune_vrt_realvsr_7frames/models/12000_optimizerG.pth

datasets: 
  train: 
    name: train_dataset
    dataroot_gt: ../datasets/realvsr/trainset/GT.lmdb
    dataroot_lq: ../datasets/realvsr/trainset/LQ.lmdb
    io_backend: 
      type: lmdb
    num_frame: 7
    gt_size: 128
    interval_list: [1]
    random_reverse: true
    use_hflip: true
    use_rot: true
    pad_sequence: false
    scale: 2
    dataloader_shuffle: true
    dataloader_num_workers: 12
    dataloader_batch_size: 1
    
  test: 
    name: test_dataset
    dataroot_gt: ../datasets/realvsr/testset/GT.lmdb
    dataroot_lq: ../datasets/realvsr/testset/LQ.lmdb
    cache_data: true
    io_backend: 
      type: lmdb
    num_frame: 7
    gt_size: 128
    interval_list: [1]
    random_reverse: true
    use_hflip: true
    use_rot: true
    pad_sequence: false
    scale: 2
    dataloader_shuffle: false
    dataloader_num_workers: 12
    

netG: 
  net_type: vrt
  spynet_path: model_zoo/vrt/spynet_sintel_final-3d2a1287.pth   # automatical download
  arguments:
    upscale: 2
    img_size: [6,64,64]
    window_size: [6,8,8]
    depths: [8,8,8,8,8,8,8, 4,4,4,4, 4,4]
    indep_reconsts: [11,12]
    embed_dims: [120,120,120,120,120,120,120, 180,180,180,180, 180,180]
    num_heads: [6,6,6,6,6,6,6, 6,6,6,6, 6,6]
    pa_frames: 2
    deformable_groups: 12
    nonblind_denoising: false
    use_checkpoint_attn: false
    use_checkpoint_ffn: false
    no_checkpoint_attn_blocks: []
    no_checkpoint_ffn_blocks: []
  init_type: default
  unfreeze_blocks: 0


train: 
  G_lossfn_types: [l2, perceptual]
  G_lossfn_weights: [0.01, 0.99]
  G_charbonnier_eps: 1e-9

  E_decay: 0 # Exponential Moving Average for netG: set 0 to disable; default setting 0.999

  G_optimizer_type: adam        # fixed, adam is enough
  G_optimizer_lr: 4e-4            # learning rate
  G_optimizer_betas: [0.9,0.99]
  G_optimizer_wd: 0               # weight decay, default 0
  G_optimizer_clipgrad: null      # unused
  G_optimizer_reuse: true         #

  fix_iter: 15000
  fix_lr_mul: 0.125
  fix_keys: ["spynet", "deform"]

  total_iter: 15000
  G_scheduler_type: CosineAnnealingWarmRestarts
  G_scheduler_periods: 1000
  G_scheduler_eta_min: 1e-7

  G_regularizer_orthstep: null    # unused
  G_regularizer_clipstep: null    # unused

  G_param_strict: false
  E_param_strict: false

  checkpoint_test: 145           # for testing
  checkpoint_save: 500           # for saving model
  checkpoint_print: 200          # for print


val: 
  save_img: false
  pad_seq: false
  flip_seq: false
  center_frame_only: false
  num_frame_testing: 7
  num_frame_overlapping: 2
  size_patch_testing: 128



